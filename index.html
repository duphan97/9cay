<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸš€ğŸ“ˆğŸš€ğŸ“ˆğŸš€</title>
  <link rel="icon" type="image/png" href="images/favicon.png">
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* DÃ¹ng 1 animation chung cho pulse, mÃ u sáº¯c dÃ¹ng tailwind */
    @keyframes pulse-base {0%,100%{opacity:1}50%{opacity:0.7}}
    .pulse-effect{animation:pulse-base 1s infinite}
    
    /* Cáº¬P NHáº¬T HIá»†U á»¨NG GLOW Cá»°C Sáº¶C Sá»  cho ngÆ°á»i tháº¯ng */
    @keyframes winner-glow-enhanced {
      0%,100%{background:#e6fffa;border: 3px solid #047857;box-shadow:0 0 15px rgba(4, 120, 87, 0.8)} /* Xanh nháº¡t, viá»n xanh Ä‘áº­m */
      50%{background:#6ee7b7;border: 3px solid #065f46;box-shadow:0 0 25px rgba(6, 95, 70, 0.9)} /* Xanh sÃ¡ng hÆ¡n, viá»n Ä‘áº­m hÆ¡n */
    }
    .winner-glow{animation:winner-glow-enhanced 1.2s infinite}
    /* END Cáº¬P NHáº¬T HIá»†U á»¨NG */
    
    /* TÃªn ngÆ°á»i chÆ¡i trong lá»‹ch sá»­: In Ä‘áº­m, mÃ u Ä‘en */
    .history-player-name {
        font-weight: 700; 
        color: #1f2937; 
        /* Flex grow Ä‘á»ƒ chiáº¿m háº¿t khÃ´ng gian cÃ²n láº¡i */
        flex-grow: 1; 
        overflow: hidden; /* TrÃ¡nh trÃ n khi tÃªn quÃ¡ dÃ i */
        text-overflow: ellipsis; 
        white-space: nowrap;
    }
    
    /* Container cho má»—i dÃ²ng lá»‹ch sá»­ Ä‘á»ƒ cÄƒn Ä‘á»u báº±ng flexbox */
    .history-item-line {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        margin-top: 2px;
    }
    
    /* Cá»‘ Ä‘á»‹nh chiá»u rá»™ng cho Ä‘iá»ƒm Ä‘á»ƒ cÄƒn Ä‘á»u tuyá»‡t Ä‘á»‘i */
    .delta-score {
        display: inline-block;
        width: 40px; /* Äá»™ rá»™ng cá»‘ Ä‘á»‹nh, Ä‘á»§ cho "+99" */
        text-align: right;
        font-weight: 600; /* in Ä‘áº­m */
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-4">
  <div id="root" class="w-full max-w-md"></div>

	<script type="text/babel">
				const { useState, useEffect, useMemo } = React;
				
				// DANH SÃCH TÃŠN Cá» Äá»ŠNH 
				const FIXED_PLAYER_NAMES = [
					"BÃ¬nh Äáº·ng", "DÅ©ng HoÃ ng", "DÅ©ng Nguyá»…n", 
					"Dá»± Phan", "Äá»‹nh NgÃ´", "ÄÃ´ng LÃª", 
					"KhÃ¡nh Äá»—", "Minh Anh", "NhÃ¢n Tráº§n", 
					"QuÃ½ Huá»³nh", "Tuáº¥n Nguyá»…n"
				];
				// END DANH SÃCH TÃŠN

				// --- BASE64 AN TOÃ€N CHO UNICODE (ÄÃƒ Sá»¬A Lá»–I btoa) ---
				// HÃ m nÃ y chuyá»ƒn Ä‘á»•i Unicode string sang Base64
				const unicodeToB64 = (str) => btoa(
					encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, (match, p1) => 
						String.fromCharCode('0x' + p1)
					)
				);

				// HÃ m nÃ y chuyá»ƒn Ä‘á»•i Base64 string trá»Ÿ láº¡i thÃ nh Unicode
				const b64ToUnicode = (str) => decodeURIComponent(
					Array.prototype.map.call(atob(str), (c) => 
						'%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)
					).join('')
				);
				// --- END FIX ---


				// --------------------------------------------------------------------------------------
				// --- GITHUB CONSTANTS (Báº®T BUá»˜C ÄIá»€N) ---
				// !!! THAY THáº¾ CHUá»–I NÃ€Y Báº°NG TOKEN Cá»¦A Báº N (ÄÃ£ chia 2 pháº§n)
				const GITHUB_TOKEN_PART1 = 'github_pat_11AHU2I4Q0eTQynszWYAnj_'; 
				const GITHUB_TOKEN_PART2 = 'g3icOcB6W3He3EFtkB3rEuvAIst0GQQf50IaXXPDllERWI7ZWWJF0pB4QeI'; 

				// Ná»‘i láº¡i token khi cháº¡y
				const GITHUB_TOKEN = GITHUB_TOKEN_PART1 + GITHUB_TOKEN_PART2; 
				
				const REPO_OWNER = 'duphan97';
				const REPO_NAME = '9cay';
				const DATA_FILE_PATH = 'data/session_history.json'; 

				const GITHUB_API_URL = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${DATA_FILE_PATH}`;
				// --------------------------------------------------------------------------------------

				function App() {
				  // Dá»¯ liá»‡u chÃ­nh
				  const [players, setPlayers] = useState(() => JSON.parse(localStorage.getItem("players")) || []);
				  const [kickedPlayers, setKickedPlayers] = useState(() => JSON.parse(localStorage.getItem("kickedPlayers")) || []);
				  const [history, setHistory] = useState(() => JSON.parse(localStorage.getItem("history")) || []);
				  
				  // totalRounds: Sá»‘ vÃ¡n CÃ’N Láº I Ä‘Æ°á»£c set tá»« láº§n Set gáº§n nháº¥t (Má»¥c tiÃªu Ä‘áº¿m)
				  const [totalRounds, setTotalRounds] = useState(() => JSON.parse(localStorage.getItem("totalRounds")) || null);
				  // roundsStartCount: Sá»‘ vÃ¡n Ä‘Ã£ chÆ¡i Táº I THá»œI ÄIá»‚M SET (Má»‘c báº¯t Ä‘áº§u Ä‘áº¿m)
				  const [roundsStartCount, setRoundsStartCount] = useState(() => JSON.parse(localStorage.getItem("roundsStartCount")) || 0);

				  // TRáº NG THÃI Má»šI: Theo dÃµi xem phiÃªn Ä‘Ã£ Ä‘Æ°á»£c lÆ°u chÆ°a
				  const [isSessionSaved, setIsSessionSaved] = useState(() => JSON.parse(localStorage.getItem("isSessionSaved")) || false);
				  
				  // *** THÃŠM Má»šI: Thá»i gian báº¯t Ä‘áº§u (VÃ¡n 1) ***
				  const [startTime, setStartTime] = useState(() => JSON.parse(localStorage.getItem("startTime")) || null);

				  // Tráº¡ng thÃ¡i phiÃªn hiá»‡n táº¡i
				  const [selectedPlayerName, setSelectedPlayerName] = useState(""); // DÃ¹ng cho dropdown
				  const [winner, setWinner] = useState("");
				  const [doubleNext, setDoubleNext] = useState(false);
				  const [manualMode, setManualMode] = useState(false);
				  
				  // Quáº£n lÃ½ thÃ´ng bÃ¡o
				  const [message, setMessage] = useState("");
				  const [messageWinner, setMessageWinner] = useState("");
				  const [messageType, setMessageType] = useState("info");
				  
				  // Tá»‘i Æ°u: Gá»™p tráº¡ng thÃ¡i Modal vÃ  dá»¯ liá»‡u liÃªn quan
				  const [modal, setModal] = useState({ type: null, data: null }); 
				  
				  // State quáº£n lÃ½ nháº¡c ná»n Double 
				  const [doubleMusic, setDoubleMusic] = useState(null); 
				  
				// --- LOGIC AUDIO ÄÃƒ ÄIá»€U CHá»ˆNH Äá»‚ CHá»ˆ PHÃT 1 FILE ---
				
				const slugifyPlayerName = (name) => {
					return name
						.toLowerCase()
						.normalize("NFD")
						.replace(/[\u0300-\u036f]/g, "") 
						.replace(/\s+/g, '') 
						.replace(/Ä‘/g, 'd'); 
				};
				
				const playAudio = (path) => {
					 const fullPath = path.startsWith('audio/') ? path : `audio/${path}`; 
					 const audio = new Audio(fullPath);
					 audio.play().catch(e => {
						console.error(`Lá»—i phÃ¡t audio ${fullPath}:`, e.name);
					});
					return audio; 
				};
				
				// Cáº¬P NHáº¬T HÃ€M: Chá»‰ phÃ¡t 1 file duy nháº¥t (Ä‘Ã£ fix delay)
				const playWinnerAudio = (winnerName, isDouble) => {
					const winnerSlug = slugifyPlayerName(winnerName);
					let audioFileName = `${winnerSlug}.mp3`; // TÃªn file máº·c Ä‘á»‹nh (vÄƒn thÆ°á»ng)

					// Náº¿u lÃ  Double, tiá»n tá»‘ thÃªm "double"
					if (isDouble) {
						audioFileName = `double${winnerSlug}.mp3`;
					}
					
					// PhÃ¡t file Ã¢m thanh Ä‘Ã£ Ä‘Æ°á»£c chuáº©n bá»‹ sáºµn
					playAudio(audioFileName);
				};
				
				// ÄIá»€U CHá»ˆNH HÃ€M: Phá»¥c há»“i Ã¢m thanh bÃ¡o 3, 2, 1 vÃ¡n
				const playRoundEndAudio = (remainingRounds) => {
					let fileToPlay = null;
					
					// 1. Kiá»ƒm tra cÃ¡c má»‘c quan trá»ng (3, 2, 1)
					if (remainingRounds === 3) {
						 fileToPlay = '3left.mp3';
					} else if (remainingRounds === 2) {
						 fileToPlay = '2left.mp3';
					} else if (remainingRounds === 1) {
						 fileToPlay = '1left.mp3';
					} 
					
					// 2. Kiá»ƒm tra Game Over (0)
					else if (remainingRounds <= 0) {
						 fileToPlay = 'gameover.mp3';
					}
					
					// PhÃ¡t file Ä‘Ã£ xÃ¡c Ä‘á»‹nh (náº¿u cÃ³), sá»­ dá»¥ng delay ngáº¯n 2.5s
					// Ä‘á»ƒ trÃ¡nh trÃ¹ng láº·p vá»›i audio ngÆ°á»i tháº¯ng vá»«a phÃ¡t xong.
					if (fileToPlay) {
						setTimeout(() => playAudio(fileToPlay), 2500); 
					}
				};
						
				// LOGIC QUáº¢N LÃ NHáº C Ná»€N DOUBLE (ÄÃƒ CHá»ˆNH Sá»¬A)
				useEffect(() => {
					if (doubleNext) {
						// Náº¿u Ä‘ang báº­t double
						if (doubleMusic) {
							// Dá»«ng nháº¡c cÅ© náº¿u cÃ³ Ä‘á»ƒ phÃ¡t láº¡i tá»« Ä‘áº§u
							doubleMusic.pause();
						}
						
						const music = new Audio('audio/doublemusic.mp3');
						music.loop = true;
						music.volume = 1.0;
						setDoubleMusic(music);
						
						music.play().catch(e => console.error("Lá»—i phÃ¡t nháº¡c ná»n Double:", e.name));
						
					} else {
						// Náº¿u Ä‘ang táº¯t double
						if (doubleMusic) {
							doubleMusic.pause();
							// Äáº·t doubleMusic vá» null Ä‘á»ƒ useEffect tiáº¿p theo táº¡o má»›i
							setDoubleMusic(null); 
						}
					}
					
					// Cleanup function Ä‘áº£m báº£o nháº¡c ná»n dá»«ng khi component unmount
					return () => {
						// KhÃ´ng cáº§n dá»«ng á»Ÿ Ä‘Ã¢y vÃ¬ logic Ä‘Ã£ Ä‘Æ°á»£c handle bÃªn trong if/else
					};
				}, [doubleNext]); 
				
				// --- Káº¾T THÃšC LOGIC AUDIO ÄÃƒ ÄIá»€U CHá»ˆNH ---


				  // TÃ­nh toÃ¡n tráº¡ng thÃ¡i vÃ²ng Ä‘áº¥u
				  const recordedRounds = useMemo(() => history.filter(h => h.type === "record").length, [history]);
				  const currentRound = recordedRounds + 1;
				  
				  const effectiveRemainingRounds = useMemo(() => {
					if (totalRounds === null) return null;
					const playedSinceSet = recordedRounds - roundsStartCount; 
					const remaining = totalRounds - playedSinceSet;
					return remaining; 
				  }, [totalRounds, recordedRounds, roundsStartCount]);
				  
				  const gameEnded = useMemo(() => 
					totalRounds !== null && effectiveRemainingRounds !== null && effectiveRemainingRounds <= 0,
					[totalRounds, effectiveRemainingRounds]
				  );
				  
				  // --- LOGIC LÆ¯U Lá»ŠCH Sá»¬ Tá»° Äá»˜NG (SILENT BACKGROUND) ---
				  
				  // HÃ€M ÄÆ¯á»¢C Cáº¬P NHáº¬T: Táº¡o Ä‘á»‘i tÆ°á»£ng dá»¯ liá»‡u phiÃªn chÆ¡i 
				  const createSessionData = () => {
					  // Láº¥y Táº¤T Cáº¢ ngÆ°á»i chÆ¡i (Ä‘ang chÆ¡i vÃ  Ä‘Ã£ dá»«ng)
					  const allFinalPlayers = [
						  ...players.map(p => ({ 
							  name: p.name, 
							  score: p.score, 
							  status: 'Playing' // NgÆ°á»i Ä‘ang chÆ¡i
						  })), 
						  ...kickedPlayers.map(p => ({ 
							  name: p.name, 
							  score: p.score, 
							  status: 'Kicked' // NgÆ°á»i Ä‘Ã£ dá»«ng
						  }))
					  ];
					  
					  // Cáº¬P NHáº¬T: Láº¥y endTime (Thá»i gian káº¿t thÃºc)
					  const endTime = new Date().toISOString(); 
					  
					  const sessionData = {
						  // Sá»­ dá»¥ng timestamp lÃ m ID phiÃªn
						  sessionId: `Session-${endTime}`, 
						  startTime: startTime, // THÃŠM Má»šI: Thá»i gian báº¯t Ä‘áº§u (tá»« state)
						  endTime: endTime, // Cáº¬P NHáº¬T: Thá»i gian káº¿t thÃºc (lÃºc lÆ°u)
						  totalRoundsSet: totalRounds,
						  roundsPlayed: history.filter(h => h.type === "record").length,
						  finalResults: allFinalPlayers, // LÆ¯U Káº¾T QUáº¢ CUá»I Cá»¦A Táº¤T Cáº¢
					  };
					  
					  return sessionData;
				  }

				  // HÃ€M ÄÆ¯á»¢C Cáº¬P NHáº¬T: Xá»­ lÃ½ lÆ°u tá»± Ä‘á»™ng vá»›i token GitHub
				  const saveSessionAutomatically = async () => {
					  if (isSessionSaved) {
						  console.log("Session already saved, skipping automatic save.");
						  return;
					  }
					  
					  const sessionData = createSessionData();
					  const newSessionEntry = sessionData; // Dá»¯ liá»‡u phiÃªn má»›i

					  console.log("Saving game session automatically to GitHub...");

					  // 1. Láº¥y ná»™i dung file hiá»‡n táº¡i (Ä‘á»ƒ láº¥y SHA vÃ  dá»¯ liá»‡u cÅ©)
					  let currentSha = null;
					  let existingHistory = [];
					  let getResponse;

					  try {
						  getResponse = await fetch(GITHUB_API_URL, {
							  method: 'GET',
							  headers: {
								  'Authorization': `token ${GITHUB_TOKEN}`,
								  'Accept': 'application/vnd.github.v3+json',
							  },
						  });
					  } catch (error) {
						  console.error("âŒ Lá»—i máº¡ng/API khi GET file:", error);
						  return; 
					  }

					  // 2. Xá»­ lÃ½ pháº£n há»“i GET
					  if (getResponse.ok) {
						  const fileData = await getResponse.json();
						  currentSha = fileData.sha;
						  
						  // Fix: Sá»¬ Dá»¤NG HÃ€M AN TOÃ€N KHI DECODE
						  const content = b64ToUnicode(fileData.content); 
						  
						  if (content) {
							  try {
								  existingHistory = JSON.parse(content);
							  } catch (e) {
								   console.error("âŒ Lá»—i parse JSON file Ä‘Ã£ cÃ³. Báº¯t Ä‘áº§u phiÃªn má»›i:", e);
								   existingHistory = [];
							  }
						  } else {
							  existingHistory = [];
						  }
						  
					  } else if (getResponse.status === 404) {
						  console.log("File data/session_history.json chÆ°a tá»“n táº¡i. Sáº½ táº¡o má»›i.");
						  existingHistory = []; // Báº¯t Ä‘áº§u vá»›i máº£ng rá»—ng
						  currentSha = null; // Äáº£m báº£o SHA lÃ  null khi táº¡o má»›i
					  } else {
						   console.error("âŒ Lá»—i khi GET file:", getResponse.status);
						   return; // Dá»«ng náº¿u GET tháº¥t báº¡i vÃ¬ lÃ½ do khÃ¡c (vd: token sai)
					  }
					  
					  // 3. Chuáº©n bá»‹ ná»™i dung má»›i
					  const updatedHistory = [newSessionEntry, ...existingHistory]; // ThÃªm má»›i lÃªn Ä‘áº§u
					  // Lá»–I Xáº¢Y RA á» ÄÃ‚Y: Sá»¬ Dá»¤NG HÃ€M AN TOÃ€N KHI ENCODE
					  const newContent = unicodeToB64(JSON.stringify(updatedHistory, null, 2));

					  // 4. Commit lÃªn GitHub
					  const commitMessage = `Auto save session: ${sessionData.roundsPlayed} rounds completed.`;
					  
					  try {
						  const putBody = {
							  message: commitMessage,
							  content: newContent,
						  };
						  // ThÃªm SHA chá»‰ khi Ä‘ang cáº­p nháº­t
						  if (currentSha) {
							  putBody.sha = currentSha;
						  }
						  
						  const putResponse = await fetch(GITHUB_API_URL, {
							  method: 'PUT',
							  headers: {
								  'Authorization': `token ${GITHUB_TOKEN}`,
								  'Content-Type': 'application/json',
							  },
							  body: JSON.stringify(putBody),
						  });

						  if (putResponse.ok) {
							  console.log("âœ… Session saved successfully to GitHub.");
							  setIsSessionSaved(true); // ÄÃ¡nh dáº¥u Ä‘Ã£ lÆ°u thÃ nh cÃ´ng
						  } else {
							  const result = await putResponse.json();
							  console.error("âŒ Failed to save session. Status:", putResponse.status, "Details:", result);
						  }
					  } catch (error) {
						  console.error("âŒ Network/API error during session save:", error);
					  }
				  };

				  // Trigger tá»± Ä‘á»™ng lÆ°u (background)
				  useEffect(() => {
					  // CHá»ˆ TRIGGER khi game ENDED vÃ  CHÆ¯A Ä‘Æ°á»£c lÆ°u.
					  if (gameEnded && !isSessionSaved) { 
							  saveSessionAutomatically();
					  }
					  
				  }, [gameEnded, isSessionSaved]);
				  // --- Káº¾T THÃšC LOGIC LÆ¯U ---


				  // LÆ°u trá»¯ dá»¯ liá»‡u vÃ o localStorage
				  useEffect(() => {
					localStorage.setItem("players", JSON.stringify(players));
					localStorage.setItem("kickedPlayers", JSON.stringify(kickedPlayers));
					localStorage.setItem("history", JSON.stringify(history));
					localStorage.setItem("totalRounds", JSON.stringify(totalRounds));
					localStorage.setItem("roundsStartCount", JSON.stringify(roundsStartCount)); 
					localStorage.setItem("isSessionSaved", JSON.stringify(isSessionSaved)); // LÆ¯U TRáº NG THÃI Má»šI
					localStorage.setItem("startTime", JSON.stringify(startTime)); // *** THÃŠM Má»šI ***
				  }, [players, kickedPlayers, history, totalRounds, roundsStartCount, isSessionSaved, startTime]); // *** THÃŠM startTime VÃ€O DEPENDENCY ***

				  // Äiá»u chá»‰nh hÃ m showTempMessage
				  const showTempMessage = (text, type = "info", duration = 2500, winnerName = "") => {
					setMessage(text);
					setMessageType(type);
					setMessageWinner(winnerName);
					setTimeout(() => { setMessage(""); setMessageWinner(""); }, duration);
				  };

				  // HÃ m thÃªm ngÆ°á»i chÆ¡i 
				  const addPlayer = () => {
					const totalPlaying = players.length;
					if (totalPlaying >= 5) return; 

					const name = selectedPlayerName.trim(); 
					if (!name) { 
						showTempMessage("âš ï¸ Vui lÃ²ng chá»n ngÆ°á»i chÆ¡i!", "warning");
						return;
					}
					
					const availableNames = FIXED_PLAYER_NAMES.filter(n => 
						!players.some(p => p.name === n)
					);
					
					if (!availableNames.includes(name) && !kickedPlayers.some(p => p.name === name)) {
						return; 
					}
					
					// KhÃ´i phá»¥c ngÆ°á»i chÆ¡i Ä‘Ã£ dá»«ng (qua chá»n tÃªn)
					const existingKickedPlayerIndex = kickedPlayers.findIndex(p => p.name === name);
					if (existingKickedPlayerIndex !== -1) {
						const playerToRestore = kickedPlayers[existingKickedPlayerIndex];
						setKickedPlayers(kickedPlayers.filter((_, idx) => idx !== existingKickedPlayerIndex));
						setPlayers([...players, playerToRestore]);
						setSelectedPlayerName(""); 
						return showTempMessage(`âœ… ${name} Ä‘Ã£ quay láº¡i trÃ² chÆ¡i!`, "info");
					}
					
					// ThÃªm ngÆ°á»i chÆ¡i má»›i (Chá»‰ xáº£y ra náº¿u tÃªn náº±m trong FIXED_PLAYER_NAMES vÃ  chÆ°a chÆ¡i)
					setPlayers([...players, { name, score: 0 }]);
					setSelectedPlayerName("");
				  };

				  const confirmReset = () => {
					setModal({ type: 'reset', data: null });
				  }
				  const cancelModal = () => setModal({ type: null, data: null });
				  
				  const resetGame = () => {
					// Dá»«ng nháº¡c ná»n khi reset
					if (doubleMusic) {
						doubleMusic.pause();
						setDoubleMusic(null);
					}
					
					setPlayers([]); setKickedPlayers([]); setHistory([]); setWinner("");
					setDoubleNext(false); setManualMode(false);
					setTotalRounds(null); 
					setRoundsStartCount(0);
					setIsSessionSaved(false); // Äáº¶T Láº I TRáº NG THÃI Má»šI NÃ€Y
					setStartTime(null); // *** THÃŠM Má»šI: Reset startTime ***
					localStorage.clear();
					setModal({ type: null, data: null });
					setSelectedPlayerName(""); 
				  };
				  
				  // --- Bá»” SUNG LOGIC TÃNH TIá»€N NGAY ---
				const settleGame = () => {
					if (gameEnded) {
						showTempMessage("âš ï¸ TrÃ² chÆ¡i Ä‘Ã£ káº¿t thÃºc rá»“i!", "warning");
						return;
					}
					
					// TÃ­nh sá»‘ vÃ¡n Ä‘Ã£ chÆ¡i ká»ƒ tá»« láº§n Set gáº§n nháº¥t
					const roundsPlayedSinceLastSet = recordedRounds - roundsStartCount;

					// 1. Force gameEnded to true by setting the goal to the rounds already played
					// This forces effectiveRemainingRounds = 0
					setTotalRounds(roundsPlayedSinceLastSet); 
					
					// 2. Play game over audio (passing 0 to playRoundEndAudio)
					playAudio('gameover.mp3');
					setModal({ type: null, data: null });
					showTempMessage("ğŸ’°Nhá»› banking sá»›m nhÃ© cÃ¡c anh!", "info", 2000); 
				};

				const confirmSettle = () => {
					if (gameEnded) return;
					// Cáº§n Ã­t nháº¥t 2 ngÆ°á»i chÆ¡i hoáº·c cÃ³ lá»‹ch sá»­ Ä‘á»ƒ tÃ­nh tiá»n/lÆ°u
					if (players.length < 2 && history.length === 0) {
						 return showTempMessage("âš ï¸ ChÆ°a cÃ³ ngÆ°á»i chÆ¡i hoáº·c vÃ¡n nÃ o Ä‘á»ƒ tÃ­nh tiá»n!", "warning");
					}
					setModal({ type: 'settle', data: null });
				}
				// --- END Bá»” SUNG LOGIC TÃNH TIá»€N NGAY ---

				  // HÃ m hiá»ƒn thá»‹ Modal xÃ¡c nháº­n ghi Ä‘iá»ƒm
				  const promptRecord = () => {
					if (gameEnded) return;
					if (players.length < 2)
					  return showTempMessage("âš ï¸ Cáº§n Ã­t nháº¥t 2 ngÆ°á»i chÆ¡i Ä‘á»ƒ báº¯t Ä‘áº§u!", "warning");
					if (!winner)
					  return showTempMessage("âš ï¸ Vui lÃ²ng chá»n ngÆ°á»i tháº¯ng!", "error");
					
					setModal({ type: 'record', data: null });
				  };

				  // HÃ m thá»±c hiá»‡n ghi Ä‘iá»ƒm (executeRecord)
				  const executeRecord = () => {
					setModal({ type: null, data: null });

					const numLosers = players.length - 1;
					const pointPerLoser = doubleNext ? 2 : 1;
					const totalWin = numLosers * pointPerLoser;

					const updatedPlayers = players.map(p => {
					  if (p.name === winner) return { ...p, score: p.score + totalWin };
					  return { ...p, score: p.score - pointPerLoser };
					});

					// *** THÃŠM Má»šI: Ghi startTime náº¿u lÃ  vÃ¡n 1 ***
					// (recordedRounds lÃ  sá»‘ vÃ¡n Ä‘Ã£ ghi TRÆ¯á»šC VÃN NÃ€Y)
					if (recordedRounds === 0) { 
						setStartTime(new Date().toISOString());
					}
					// *** Káº¾T THÃšC THÃŠM Má»šI ***

					const changes = updatedPlayers.map((p, i) => ({
					  name: p.name,
					  delta: p.score - players[i].score,
					}));

					const wasDouble = doubleNext; 
					const newHistory = [...history, { type: "record", winner, changes, isDouble: wasDouble }];
					
					setPlayers(updatedPlayers);
					setHistory(newHistory);
					
					// --- Xá»¬ LÃ AUDIO ÄÃƒ Cáº¬P NHáº¬T ---
					playWinnerAudio(winner, wasDouble);
					
					// TÃ­nh sá»‘ vÃ¡n cÃ²n láº¡i SAU khi ghi Ä‘iá»ƒm
					const newRecordedRounds = recordedRounds + 1;
					const newRemainingRounds = totalRounds === null 
						? null 
						: totalRounds - (newRecordedRounds - roundsStartCount);
					
					if (newRemainingRounds !== null) {
						playRoundEndAudio(newRemainingRounds);
					}
					// --------------------

					setWinner("");
					setDoubleNext(false); // Reset Double Next

					const messageText = wasDouble 
					  ? `âœ… ÄÃ£ ghi Ä‘iá»ƒm vÃ¡n ${currentRound} (Double)`
					  : `âœ… ÄÃ£ ghi Ä‘iá»ƒm vÃ¡n ${currentRound}`;
					
					showTempMessage(messageText, "success", 3000, winner); 
				  };
				  
				  // HÃ m hiá»ƒn thá»‹ Modal xÃ¡c nháº­n HoÃ n tÃ¡c (promptUndo)
				  const promptUndo = () => {
					if (gameEnded || history.length === 0) return;
					
					const lastRecordIndex = history.map(h => h.type).lastIndexOf("record");
					if (lastRecordIndex === -1) {
						 return showTempMessage("âš ï¸ KhÃ´ng cÃ³ vÃ¡n nÃ o Ä‘á»ƒ hoÃ n tÃ¡c!", "warning");
					}
					
					const lastAction = history.length > 0 ? history[history.length - 1].type : null;
					if (lastAction === "undo") {
						return showTempMessage("âš ï¸ KhÃ´ng thá»ƒ hoÃ n tÃ¡c liÃªn tiáº¿p!", "error");
					}
					
					const lastRecord = history[lastRecordIndex];
					const undoRoundNum = history.filter((_, idx) => idx <= lastRecordIndex && _.type === "record").length;
					
					setModal({ 
						type: 'undo', 
						data: { 
							lastRecord, 
							undoRoundNum,
							lastRecordIndex 
						} 
					});
				  };

				  // HÃ m thá»±c hiá»‡n HoÃ n tÃ¡c (executeUndo) - XÃ“A báº£n ghi record cuá»‘i cÃ¹ng (ÄÃƒ Cáº¬P NHáº¬T AUDIO)
				  const executeUndo = () => {
					const { lastRecord, undoRoundNum, lastRecordIndex } = modal.data;
					setModal({ type: null, data: null }); 

					// 1. HoÃ n Ä‘iá»ƒm
					const reverted = players.map(p => {
					  const change = lastRecord.changes.find(c => c.name === p.name)?.delta || 0;
					  return { ...p, score: p.score - change };
					});
					
					// 2. Cáº­p nháº­t History
					const tempHistory = [...history];
					tempHistory.splice(lastRecordIndex, 1);
					
					const undoEvent = { 
						type: "undo", 
						targetRound: undoRoundNum, 
						undoChanges: lastRecord.changes, 
						undoWinner: lastRecord.winner,
						undoDouble: lastRecord.isDouble,
						timestamp: new Date().toISOString()
					};
					
					const newHistory = [...tempHistory, undoEvent];

					// 3. Cáº­p nháº­t State
					setPlayers(reverted);
					setHistory(newHistory); 
					setWinner("");
					setDoubleNext(false);
					
					// Dá»«ng nháº¡c ná»n Double náº¿u nÃ³ Ä‘ang cháº¡y vÃ  vÃ¡n vá»«a hoÃ n tÃ¡c lÃ  Double
					if (doubleMusic && lastRecord.isDouble) {
						doubleMusic.pause();
						setDoubleMusic(null);
					}
					
					// Náº¿u hoÃ n tÃ¡c xáº£y ra khi gameEnded=true, ta cáº§n Ä‘Ã¡nh dáº¥u láº¡i lÃ  chÆ°a lÆ°u.
					if (gameEnded) {
						setIsSessionSaved(false);
					}
					
					// Bá»” SUNG: PhÃ¡t audio khi hoÃ n tÃ¡c
					playAudio('hoantac.mp3');

					showTempMessage(`â†©ï¸ ÄÃ£ hoÃ n tÃ¡c VÃ¡n ${undoRoundNum}.`, "info");
				  };


				  const adjustScore = (i, delta) => {
					const updated = [...players];
					let newScore = updated[i].score + delta;
					if (newScore > 999) newScore = 999;
					if (newScore < -999) newScore = -999;
					updated[i].score = newScore;
					setPlayers(updated);
				  };

				  const updateManualName = (i, v) => {
					const updated = [...players];
					updated[i].name = v;
					setPlayers(updated);
				  };

				  const promptKick = (i) => {
					if (manualMode) return;
					setModal({ type: 'kick', data: { ...players[i], index: i } });
				  };

				  const executeKick = () => {
					const playerToKick = modal.data;
					if (!playerToKick) return;
					const { name, index } = playerToKick;
					
					setKickedPlayers([...kickedPlayers, players[index]]);
					setPlayers(players.filter((_, idx) => idx !== index));
					if (winner === name) setWinner("");
					setSelectedPlayerName(""); 
					
					showTempMessage(`ğŸš« ${name} Ä‘Ã£ dá»«ng chÆ¡i!`);
					setModal({ type: null, data: null });
				  };
				  
				  const promptComeback = (player, index) => {
					  if (isComebackDisabled) return;
					  setModal({ type: 'comeback', data: { player, index } });
				  };
				  
				  const executeComeback = () => {
					  const { player, index } = modal.data;

					  setKickedPlayers(kickedPlayers.filter((_, idx) => idx !== index));
					  setPlayers([...players, player]);
					  
					  showTempMessage(`ğŸ‘‹ ${player.name} Ä‘Ã£ quay trá»Ÿ láº¡i!`, "info");
					  setModal({ type: null, data: null });
				  };

				  const total = [...players, ...kickedPlayers].reduce((s, p) => s + p.score, 0);
				  const totalOk = Math.abs(total) < 1e-6;

				  // HÃ m toggleManualMode (ÄÃƒ Cáº¬P NHáº¬T AUDIO)
				  const toggleManualMode = () => {
					if (manualMode) {
						if (!totalOk) {
							showTempMessage("âš ï¸ Tá»•ng Ä‘iá»ƒm khÃ´ng báº±ng 0, vui lÃ²ng kiá»ƒm tra láº¡i!", "error");
							return;
						}
						// Bá»” SUNG: PhÃ¡t audio khi hoÃ n thÃ nh nháº­p Ä‘iá»ƒm
						playAudio('nhapdiemthucong.mp3'); 
					}
					setManualMode(!manualMode);
				  };

				  // Bá»• sung: State vÃ  logic cho Set Rounds
				  const [roundInput, setRoundInput] = useState("");

				  const promptSetRounds = () => {
					// Hiá»ƒn thá»‹ sá»‘ vÃ¡n cÃ²n láº¡i (hoáº·c 5 vÃ¡n máº·c Ä‘á»‹nh) vÃ o input
					setRoundInput(effectiveRemainingRounds !== null && effectiveRemainingRounds > 0 ? String(effectiveRemainingRounds) : "5");
					setModal({ type: 'setRounds', data: null });
				  };

				  // LOGIC applySetRounds (ÄÃƒ Cáº¬P NHáº¬T AUDIO)
				  const applySetRounds = () => {
					const num = parseInt(roundInput);
					if (isNaN(num) || num <= 0)
					  return showTempMessage("âš ï¸ Nháº­p sá»‘ há»£p lá»‡ (> 0)!", "warning");
					
					// 1. LÆ°u sá»‘ vÃ¡n Ä‘Ã£ chÆ¡i Táº I THá»œI ÄIá»‚M NÃ€Y lÃ m má»‘c báº¯t Ä‘áº§u Ä‘áº¿m
					setRoundsStartCount(recordedRounds);
					
					// 2. totalRounds lÃ  sá»‘ vÃ¡n CÃ’N Láº I Ä‘Æ°á»£c set (Má»¥c tiÃªu Ä‘áº¿m)
					setTotalRounds(num); 
					
					setModal({ type: null, data: null });
					setRoundInput("");
					showTempMessage(`âœ… ÄÃ£ Ä‘áº·t cÃ²n ${num} vÃ¡n ná»¯a!`);
					
					// Bá»” SUNG: PhÃ¡t audio khi Ä‘áº·t sá»‘ vÃ¡n
					playAudio('dasetsovan.mp3');
				  };

				  const canSelectWinner = players.length >= 2 && !manualMode && !gameEnded;
				  const isMaxPlayers = players.length >= 5;
				  const isFeatureDisabled = manualMode || gameEnded;
				  const isAddPlayerDisabled = isFeatureDisabled || isMaxPlayers; 
				  const isComebackDisabled = isMaxPlayers || isFeatureDisabled;
				  
				  // Lá»c ra cÃ¡c tÃªn chÆ°a cÃ³ trong danh sÃ¡ch Ä‘ang chÆ¡i
				  const availablePlayerNames = useMemo(() => {
					  const playingNames = players.map(p => p.name);
					  return FIXED_PLAYER_NAMES.filter(name => !playingNames.includes(name));
				  }, [players]);

				  return (
					<div className="bg-white rounded-2xl shadow-lg p-5 w-full relative">
					  
					  {/* Äiá»u chá»‰nh: Vá»‹ trÃ­ vÃ  kÃ­ch thÆ°á»›c thÃ´ng bÃ¡o */}
						{message && (
						  <div className={`fixed inset-0 flex items-center justify-center z-[100]`}>
							<div className={`px-4 py-3 rounded-xl shadow-2xl text-lg font-bold transition-all duration-300 text-center w-full max-w-xs mx-4 ${ 
							  messageType === "warning" ? "bg-yellow-400 text-black"
							  : messageType === "error" ? "bg-red-200 text-red-800"
							  : messageType === "success" ? "bg-green-600 text-white"
							  : "bg-blue-500 text-white"
							}`}>
							  {/* HÃ€NG 1: Ná»™i dung chung */}
							  <div>
								  {message}
							  </div>
							  
							  {/* HÃ€NG 2: TÃªn ngÆ°á»i tháº¯ng (Chá»‰ hiá»ƒn thá»‹ khi ghi Ä‘iá»ƒm) */}
							  {messageWinner && messageType === "success" && (
								  <div className="text-red-600 text-2xl font-bold mt-1">
									  {messageWinner}
								  </div>
							  )}
							</div>
						  </div>
						)}

					  <h1 className="text-2xl font-bold text-center mb-4 text-green-600">90% ngÆ°á»i chÆ¡i dá»«ng láº¡i trÆ°á»›c khi tháº¯ng lá»›n!ğŸ’°ğŸ’°</h1>

					  {gameEnded && (
						<div className="text-center text-red-600 font-bold mb-3 text-lg">
						  ğŸ TrÃ² chÆ¡i Ä‘Ã£ káº¿t thÃºc â€” Reset Ä‘á»ƒ báº¯t Ä‘áº§u láº¡i
						</div>
					  )}

					  {/* THÃŠM ngÆ°á»i chÆ¡i báº±ng Dropdown */}
					  <div className="flex mb-3">
						<select
						  className="flex-grow border rounded-l-lg px-3 py-2 bg-white"
						  value={selectedPlayerName}
						  onChange={e => setSelectedPlayerName(e.target.value)}
						  disabled={isAddPlayerDisabled}
						>
							{/* Option máº·c Ä‘á»‹nh/Full slot */}
							{isMaxPlayers ? (
								<option value="" disabled>Full slot</option>
							) : (
								<option value="" disabled>Chá»n ngÆ°á»i chÆ¡i</option>
							)}

							{/* Lá»c cÃ¡c tÃªn kháº£ dá»¥ng */}
							{availablePlayerNames.map(name => {
								const isKicked = kickedPlayers.some(p => p.name === name);
								return (
									<option key={name} value={name}>
										{name} {isKicked ? " (Quay láº¡i)" : ""}
									</option>
								);
							})}
						</select>
						<button
						  // NÃºt "ThÃªm" bá»‹ disable náº¿u Ä‘á»§ ngÆ°á»i hoáº·c chÆ°a chá»n tÃªn (selectedPlayerName lÃ  "")
						  className={`px-4 py-2 rounded-r-lg text-white ${
							isAddPlayerDisabled || !selectedPlayerName ? "bg-gray-400 cursor-not-allowed" : "bg-blue-500"
						  }`}
						  onClick={addPlayer}
						  disabled={isAddPlayerDisabled || !selectedPlayerName}
						>ThÃªm</button>
					  </div>
					  {/* END THÃŠM */}

					  {/* Danh sÃ¡ch ngÆ°á»i chÆ¡i */}
					  {players.length === 0 ? (
						<p className="text-gray-500 text-center">ğŸ§â€â™‚ï¸ Vui lÃ²ng thÃªm tá»‘i thiá»ƒu 2 ngÆ°á»i Ä‘á»ƒ báº¯t Ä‘áº§u</p>
					  ) : (
						<>
						  <ul className="space-y-2">
							{players.map((p, i) => (
							  <li
								key={i}
								className={`flex justify-between items-center border rounded-lg px-3 py-2 transition ${
								  winner === p.name 
									? "winner-glow font-semibold" 
									: "bg-yellow-50 border-gray-300" // Ná»n vÃ ng nháº¹ vÃ  viá»n cá»‘ Ä‘á»‹nh
								} ${canSelectWinner ? "cursor-pointer" : "cursor-default"}`}
								onClick={() => canSelectWinner && setWinner(p.name)}
							  >
								{manualMode ? (
								  <div className="flex items-center justify-between w-full">
									<input
									  className="border rounded px-2 flex-grow mr-2"
									  value={p.name}
									  onChange={e => updateManualName(i, e.target.value)}
									  disabled={gameEnded}
									/>
									<div className="flex items-center gap-1">
									  <button 
										className="bg-gray-300 px-2 rounded text-lg font-bold" 
										onClick={() => adjustScore(i, -1)}
										disabled={gameEnded}
									  >-</button>
									  <span className="w-10 text-center">{p.score}</span>
									  <button 
										className="bg-gray-300 px-2 rounded text-lg font-bold" 
										onClick={() => adjustScore(i, 1)}
										disabled={gameEnded}
									  >+</button>
									</div>
								  </div>
								) : (
								  <>
									<span>{p.name}</span>
									<div className="flex items-center gap-2">
									  <span>{p.score}</span>
									  <button
										className={`text-white px-2 rounded text-sm ${isFeatureDisabled ? "bg-gray-400 cursor-not-allowed" : "bg-red-500"}`}
										onClick={(e) => { e.stopPropagation(); promptKick(i); }}
										disabled={isFeatureDisabled}
									  >
										ğŸš« Kick
									  </button>
									</div>
								  </>
								)}
							  </li>
							))}
						  </ul>

						  {players.length < 2 && (
							<p className="text-gray-500 text-center mt-2">
							  ğŸ§â€â™‚ï¸ Vui lÃ²ng thÃªm tá»‘i thiá»ƒu 2 ngÆ°á»i Ä‘á»ƒ báº¯t Ä‘áº§u
							</p>
						  )}

						  <div className="mt-3 text-center font-semibold">
							<div className={`${totalOk ? "text-green-600" : "text-red-600"}`}>
							  {totalOk ? "âœ… Tá»•ng Ä‘iá»ƒm há»£p lá»‡ (0)" : `âš ï¸ Tá»•ng Ä‘iá»ƒm khÃ´ng báº±ng 0 (${total})`}
							</div>
							<div className="text-gray-700 mt-1">
							  ğŸ§® VÃ¡n thá»©: {currentRound}
							  {totalRounds !== null && (
								<span> | â³ CÃ²n {effectiveRemainingRounds > 0 ? effectiveRemainingRounds : 0} / {totalRounds} vÃ¡n</span>
							  )}
							</div>
						  </div>
						</>
					  )}

					  {/* NgÆ°á»i Ä‘Ã£ dá»«ng chÆ¡i */}
					  {kickedPlayers.length > 0 && (
						<div className="mt-4">
						  <h3 className="text-md font-semibold text-gray-700 mb-1">ğŸ¯ NgÆ°á»i Ä‘Ã£ dá»«ng chÆ¡i:</h3>
						  <ul className="space-y-1">
							{kickedPlayers.map((p, i) => (
							  <li key={i} className="flex justify-between items-center bg-gray-100 border rounded px-3 py-1 text-sm">
								<span>{p.name}</span>
								<div className="flex items-center gap-2">
									<span className="font-semibold">{p.score}</span>
									<button
										className={`text-white px-2 py-0.5 rounded text-xs ${isComebackDisabled ? "bg-gray-400 cursor-not-allowed" : "bg-green-500"}`}
										onClick={() => promptComeback(p, i)}
										disabled={isComebackDisabled}
										title={isMaxPlayers ? "ÄÃ£ Ä‘á»§ 5 ngÆ°á»i chÆ¡i" : ""}
									>
										Comeback
									</button>
								</div>
							  </li>
							))}
						  </ul>
						</div>
					  )}

					  {/* CÃ¡c nÃºt chá»©c nÄƒng */}
					  {players.length >= 2 && !gameEnded && (
						<>
						  <div className="flex gap-2 mt-3">
							<button 
								className={`flex-1 py-2 rounded text-white ${isFeatureDisabled ? "bg-gray-400 cursor-not-allowed" : "bg-green-500"} ${doubleNext ? "pulse-effect bg-red-600" : ""}`} 
								onClick={promptRecord} 
								disabled={isFeatureDisabled}
							>
								{doubleNext ? "âœ… Ghi Ä‘iá»ƒm Double" : "âœ… Ghi Ä‘iá»ƒm"}
							</button>
							<button 
								className={`flex-1 py-2 rounded text-white transition-all ${doubleNext ? "bg-red-500 pulse-effect" : "bg-gray-400"} ${isFeatureDisabled ? "opacity-50 cursor-not-allowed" : ""}`} 
								onClick={() => setDoubleNext(!doubleNext)}
								disabled={isFeatureDisabled}
							>
							  {doubleNext ? "ğŸ’¥ Double ON" : "ğŸ’¥ Double"}
							</button>
							<button 
								className={`flex-1 py-2 rounded text-white ${isFeatureDisabled ? "bg-gray-400 cursor-not-allowed" : "bg-gray-500"}`} 
								onClick={promptUndo}
								disabled={isFeatureDisabled}
							>â†©ï¸ HoÃ n tÃ¡c</button>
						  </div>

						  <div className="mt-3">
							<button 
								className={`w-full py-2 text-white rounded ${isFeatureDisabled ? "bg-gray-400 cursor-not-allowed" : "bg-blue-600"}`} 
								onClick={promptSetRounds}
								disabled={isFeatureDisabled}
							>
							  ğŸ¯ Set sá»‘ vÃ¡n cÃ²n láº¡i
							</button>
						  </div>

						  <button
							className={`mt-3 w-full py-2 rounded font-semibold ${
								manualMode && totalOk ? "bg-blue-500 text-white" : 
								manualMode && !totalOk ? "bg-gray-600 text-white cursor-not-allowed" : 
								"bg-blue-500 text-white"
							}`}
							onClick={toggleManualMode}
							disabled={gameEnded || (manualMode && !totalOk)} 
						  >
							{manualMode ? (totalOk ? "ğŸ’¾ HoÃ n thÃ nh" : "âš ï¸ Tá»•ng Ä‘iá»ƒm â‰  0") : "âœï¸ Nháº­p Ä‘iá»ƒm thá»§ cÃ´ng"}
						  </button>
						</>
					  )}
					  
					  {/* NÃºt TÃ­nh tiá»n vÃ  Reset (ÄÃƒ CHIA ÄÃ”I Äá»˜ Rá»˜NG) */}
					  <div className="flex gap-2 mt-4">
						<button 
						   className={`flex-1 bg-orange-500 text-white px-3 py-2 rounded ${gameEnded ? "opacity-50 cursor-not-allowed" : ""}`} 
						   onClick={confirmSettle}
						   disabled={gameEnded}
						>
						   ğŸ’° TÃ­nh tiá»n
						</button>
						<button 
							className="flex-1 bg-red-500 text-white px-3 py-2 rounded" 
							onClick={confirmReset}
						>
							Reset
						</button>
					  </div>

					  {/* START: Gá»™p cÃ¡c Modal */}
					  {modal.type && (
						<div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
						  <div className="bg-white p-5 rounded-xl shadow-lg text-center w-full max-w-sm mx-4">
							
							{/* Modal Reset */}
							{modal.type === 'reset' && (
								<>
								  <p className="font-semibold mb-4">Reset toÃ n bá»™ dá»¯ liá»‡u?</p>
								  <div className="flex justify-center gap-4">
									<button className="bg-red-500 text-white px-4 py-2 rounded" onClick={resetGame}>XÃ¡c nháº­n reset</button>
									<button className="bg-gray-400 text-white px-4 py-2 rounded" onClick={cancelModal}>Há»§y</button>
								  </div>
								</>
							)}
							
							{/* Modal Settle */}
							{modal.type === 'settle' && (
								<>
								  <p className="font-semibold mb-4 text-orange-600">Báº¡n muá»‘n káº¿t thÃºc vÃ  TÃ­nh tiá»n ngay?</p>
								  <div className="flex justify-center gap-4">
									<button className="bg-orange-500 text-white px-4 py-2 rounded" onClick={settleGame}>XÃ¡c nháº­n TÃ­nh tiá»n</button>
									<button className="bg-gray-400 text-white px-4 py-2 rounded" onClick={cancelModal}>Há»§y</button>
								  </div>
								</>
							)}

							{/* Modal Kick */}
							{modal.type === 'kick' && modal.data && (
								<>
								  <p className="font-semibold mb-4">ÄÃ¡ Ä‘Ã­t <span className="text-red-600 font-bold">{modal.data.name}</span> khá»i trÃ² chÆ¡i?</p>
								  <div className="flex justify-center gap-4">
									<button className="bg-red-500 text-white px-4 py-2 rounded" onClick={executeKick}>XÃ¡c nháº­n</button>
									<button className="bg-gray-400 text-white px-4 py-2 rounded" onClick={cancelModal}>Há»§y</button>
								  </div>
								</>
							)}

							{/* Modal Comeback */}
							{modal.type === 'comeback' && modal.data && (
								<>
								  <p className="font-semibold mb-4">ÄÆ°a <span className="text-green-600 font-bold">{modal.data.player.name}</span> quay láº¡i?</p>
								  <div className="flex justify-center gap-4">
									<button className="bg-green-500 text-white px-4 py-2 rounded" onClick={executeComeback}>XÃ¡c nháº­n</button>
									<button className="bg-gray-400 text-white px-4 py-2 rounded" onClick={cancelModal}>Há»§y</button>
								  </div>
								</>
							)}
							
							{/* Modal Ghi Ä‘iá»ƒm */}
							{modal.type === 'record' && (
								<>
								  <p className="font-semibold mb-4">
									Ghi Ä‘iá»ƒm vÃ¡n <span className="text-blue-600 font-bold">{currentRound}</span> 
									{doubleNext 
									  ? <span className="text-red-600 font-bold"> (Double) </span> 
									  : " "}
									cho <span className="text-blue-600 font-bold">{winner}</span>?
								  </p>
								  <div className="flex justify-center gap-4">
									<button className={`text-white px-4 py-2 rounded ${doubleNext ? "bg-red-500" : "bg-green-500"}`} onClick={executeRecord}>XÃ¡c nháº­n ghi Ä‘iá»ƒm</button>
									<button className="bg-gray-400 text-white px-4 py-2 rounded" onClick={cancelModal}>Há»§y</button>
								  </div>
								</>
							)}

							{/* Modal HoÃ n tÃ¡c */}
							{modal.type === 'undo' && modal.data && (
								<>
								  <p className="font-semibold mb-2 text-red-600">
									HoÃ n tÃ¡c vÃ¡n {modal.data.undoRoundNum}?
								  </p>
								  <div className='text-sm text-gray-700 mb-4 border p-2 rounded'>
									VÃ¡n tháº¯ng cá»§a: <span className='font-bold'>{modal.data.lastRecord.winner}</span> 
									{modal.data.lastRecord.isDouble && <span className='text-red-500 font-bold'> (Double)</span>}
								  </div>
								  <div className="flex justify-center gap-4">
									<button className="bg-red-500 text-white px-4 py-2 rounded" onClick={executeUndo}>XÃ¡c nháº­n HoÃ n tÃ¡c</button>
									<button className="bg-gray-400 text-white px-4 py-2 rounded" onClick={cancelModal}>Há»§y</button>
								  </div>
								</>
							)}
							
							{/* Modal Set Rounds */}
							{modal.type === 'setRounds' && (
								<>
								  <p className="font-semibold mb-4">ğŸ¯ Äáº·t sá»‘ vÃ¡n cÃ²n láº¡i:</p>
								  <input
									  type="number"
									  className="w-full border rounded px-3 py-2 mb-4 text-lg text-center"
									  placeholder="Nháº­p sá»‘ vÃ¡n..."
									  value={roundInput}
									  onChange={e => setRoundInput(e.target.value)}
									  onKeyDown={e => e.key === "Enter" && applySetRounds()}
									  autoFocus
									  disabled={isFeatureDisabled}
								  />
								  <div className="flex justify-center gap-4">
									  <button 
										  className="bg-green-500 text-white px-4 py-2 rounded" 
										  onClick={applySetRounds}
										  disabled={isFeatureDisabled}
									  >
										  LÆ°u ({roundInput || 0} vÃ¡n)
									  </button>
									  <button 
										  className="bg-gray-400 text-white px-4 py-2 rounded" 
										  onClick={() => {
											  cancelModal();
											  setRoundInput("");
										  }}
									  >
										  Há»§y
									  </button>
								  </div>
								</>
							)}
							
						  </div>
						</div>
					  )}
					  {/* END: Gá»™p cÃ¡c Modal */}

					  {/* Lá»‹ch sá»­ */}
					  <h2 className="text-lg font-semibold mt-4 mb-2">ğŸ“œ Lá»‹ch sá»­</h2>
					  {history.length === 0 ? (
						<p className="text-gray-500">ChÆ°a cÃ³ vÃ¡n nÃ o.</p>
					  ) : (
						<ul className="space-y-1 max-h-60 overflow-y-auto">
						  {[...history].reverse().map((h, i) => {
							const globalIndex = history.length - 1 - i;

							if (h.type === "undo") {
								// Hiá»ƒn thá»‹ sá»± kiá»‡n hoÃ n tÃ¡c
								return (
									<li key={globalIndex} className="border border-yellow-500 rounded p-2 text-sm bg-yellow-100">
										<strong>â†©ï¸ ÄÃ£ hoÃ n tÃ¡c VÃ¡n {h.targetRound}</strong>
									</li>
								);
							}
							
							// VÃ¡n ghi Ä‘iá»ƒm thÃ´ng thÆ°á»ng
							const roundNum = history.filter((_, idx) => idx <= globalIndex && _.type === "record").length;
							
							return (
							  <li key={globalIndex} className={`border rounded p-2 text-sm ${h.isDouble ? "bg-red-50 border-red-400" : "bg-gray-50"}`}>
								<strong className={h.isDouble ? "text-red-600" : ""}>
								  VÃ¡n {roundNum}{h.isDouble ? " (Double)" : ""}
								</strong>: ğŸ† <span className={h.isDouble ? "text-red-600 font-bold" : "text-green-600 font-bold"}>{h.winner}</span>
								<div className="text-gray-600 mt-1 pl-2">
								  {h.changes.map(c => (
									// Sá»­ dá»¥ng Flexbox Ä‘á»ƒ cÄƒn Ä‘á»u tuyá»‡t Ä‘á»‘i
									<div key={c.name} className="history-item-line">
										
										{/* Cá»™t 1: TÃªn ngÆ°á»i chÆ¡i + Dáº¥u ":" (Flex-grow: 1) */}
										<div className="history-player-name">
											{c.name}:
										</div>
										
										{/* Cá»™t 2: +/- Äiá»ƒm (Äá»™ rá»™ng cá»‘ Ä‘á»‹nh 40px, cÄƒn pháº£i) */}
										<span className={`delta-score ${
											c.delta > 0 ? 'text-green-600' : 
											c.delta < 0 ? 'text-red-600' : 
											'text-gray-600'
										}`}>
											{c.delta > 0 ? "+" : ""}{c.delta}
										</span>
									</div>
								  ))}
								</div>
							  </li>
							);
						  })}
						</ul>
					  )}
					</div>
				  );
				}

				const root = ReactDOM.createRoot(document.getElementById("root"));
				root.render(<App />);
			  </script>
</body>
</html>
